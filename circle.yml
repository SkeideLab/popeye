## Customize the test machine on circleci
machine: 
    timezone:
        America/New_York
    python:
        version:
            2.7.6
    environment:
        CIRCLE_ENV: test
    
## Customize dependencies
dependencies:
    pre:
        - pip install nose
        - pip install pillow
        - pip install numpy
        - pip install nibabel
        - pip install cython
        - pip install scipy
        - sudo apt-get install python-matplotlib
        - pip install git+git://github.com/rainwoodman/sharedmem
        - pip install coverage;
        - pip install coveralls;
    post:
        - sudo mkdir ./run_tests/
        
## Customize the tests
test:
    pwd:
        ./run_tests/
    pre:
        - python setup.py install build_ext
        # this is a hack! i can't figure out how to cd in the circleci environment (see old commits for my various attempts)
        # as a result, staying in the build directory will try to import spinach from ./ where we want it from the site-package
        # - python -c "import os;import shutil;exec('def find(name, path):\n\tfor root, dirs, files in os.walk(path):\n\t\tif name in files:\n\t\t\treturn os.path.join(root, name)');srcfile = find('spinach.so','.');dstfile = './popeye/spinach.so';shutil.copy(srcfile, dstfile)"        
    override:
        - nosetests --with-doctest --verbose --with-coverage --cover-package popeye
    post:
        - coveralls
        
        
